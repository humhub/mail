humhub.module("mail.notification",function(o,e,a){function n(){i.get(o.config.url.count).then(function(e){c(parseInt(e.newMessages))})}var s,i=e("client"),r=e("ui.loader"),t=e("event"),l=e("ui.widget").Widget,u=0,c=(o.initOnPjaxLoad=!0,function(e){var n=a("#badge-messages");e&&0!==parseInt(e)?(n.removeClass("d-none"),u=e,n.empty(),n.append(e),n.fadeIn("fast")):(n.addClass("d-none"),u=0),t.trigger("humhub:modules:notification:UpdateTitleNotificationCount")});o.export({init:function(e){e||(t.on("humhub:modules:mail:live:NewUserMessage",function(e,n){n=n[n.length-1];c(n.data.count)}).on("humhub:modules:mail:live:UserMessageDeleted",function(e,n){n=n[n.length-1];c(n.data.count)}),a("#icon-messages").click(function(){s&&s.abort();const n=a("#loader_messages"),t=n.parent();n.parent().find(":not(#loader_messages)").remove(),r.set(n.removeClass("d-none")),i.get(o.config.url.list,{beforeSend:function(e){s=e}}).then(function(e){s=void 0,t.prepend(a(e.html)),n.addClass("d-none"),t.niceScroll({cursorwidth:"7",cursorborder:"",cursorcolor:"#555",cursoropacitymax:"0.2",nativeparentscrolling:!1,railpadding:{top:0,right:3,left:0,bottom:0}})})})),n()},loadMessage:function(e){var n=l.instance("#mail-conversation-root");n&&"function"==typeof n.loadMessage?(n.loadMessage(e),n.$.closest(".container").addClass("mail-conversation-single-message")):i.redirect(e.url),e.finish()},setMailMessageCount:c,updateCount:n,getNewMessageCount:function(){return u}})});