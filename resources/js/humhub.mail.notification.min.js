humhub.module("mail.notification",function(n,e,s){function o(){a.get(n.config.url.count).then(function(e){u(parseInt(e.newMessages))})}var t,a=e("client"),i=e("ui.loader"),l=e("event"),r=e("ui.widget").Widget,u=(n.initOnPjaxLoad=!0,function(e){var n=s("#badge-messages");e&&"0"!=e?(n.empty(),n.append(e),n.fadeIn("fast")):n.css("display","none")});n.export({init:function(e){e||(l.on("humhub:modules:mail:live:NewUserMessage",function(e,n){l=n[n.length-1],u(l.data.count)}).on("humhub:modules:mail:live:UserMessageDeleted",function(e,n){l=n[n.length-1],u(l.data.count)}),s("#icon-messages").click(function(){t&&t.abort(),s("#loader_messages").parent().find(":not(#loader_messages)").remove(),i.set(s("#loader_messages").show()),a.get(n.config.url.list,{beforeSend:function(e){t=e}}).then(function(e){t=void 0,s("#loader_messages").parent().prepend(s(e.html)),s("#loader_messages").hide()})})),o()},loadMessage:function(e){s("#mail-conversation-root").length?(r.instance("#mail-conversation-root").loadMessage(e),s("#mail-conversation-root").closest(".container").addClass("mail-conversation-single-message")):a.redirect(e.url),e.finish()},setMailMessageCount:u,updateCount:o})});